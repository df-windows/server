# 2024-07-28 "Refactor Apache settings": https://github.com/df-windows/server/issues/2
Define BP "C:/server/apache"
ErrorLog "C:/server/log/apache.log"
KeepAlive On
KeepAliveTimeout 600000
# 2021-04-18
# 1) The default value is `8190`: https://httpd.apache.org/docs/2.4/mod/core.html#limitrequestfieldsize
# 2) It is twice as high as in Magento (4096): https://github.com/magento/magento2/blob/2.4.2/lib/internal/Magento/Framework/Stdlib/Cookie/PhpCookieManager.php#L35
# https://stackoverflow.com/a/19285146
# 3) I have increased it up to `16000` to emulate the error:
# «Unable to send the cookie. Size of 'mage-messages' is 8226 bytes»
# https://github.com/canadasatellite-ca/site/issues/71
# 4) In my case, Nginx is uses as a proxy to Apache,
# and Nginx has a similar limit defined by the `large_client_header_buffers` parameter:
# http://nginx.org/en/docs/http/ngx_http_core_module.html#large_client_header_buffers
# I have increased it too in the `nginx.conf` file: `large_client_header_buffers 4 16k;`.
# https://stackoverflow.com/a/19285146
LimitRequestFieldSize 16000
Listen 80
# 2017-04-30
# Отключить mpm_winnt:notice и core:notice невозможно:
# «When logging to a regular file, messages of the level notice cannot be suppressed and thus are always logged.»
# https://httpd.apache.org/docs/2.4/mod/core.html#LogLevel
LogLevel warn
MaxKeepAliveRequests 0
MaxRequestsPerChild 0
ServerName localhost.com
ServerRoot "${BP}"
ThreadsPerChild 128
TimeOut 600000
LoadModule actions_module modules/mod_actions.so
LoadModule alias_module modules/mod_alias.so
ScriptAlias /cgi-bin/ "${BP}/cgi-bin/"
LoadModule allowmethods_module modules/mod_allowmethods.so
LoadModule asis_module modules/mod_asis.so
LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authn_file_module modules/mod_authn_file.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule autoindex_module modules/mod_autoindex.so
LoadModule cgi_module modules/mod_cgi.so
LoadModule dir_module modules/mod_dir.so
LoadModule env_module modules/mod_env.so
LoadModule include_module modules/mod_include.so
LoadModule isapi_module modules/mod_isapi.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule mime_module modules/mod_mime.so
LoadModule negotiation_module modules/mod_negotiation.so
LoadModule setenvif_module modules/mod_setenvif.so
# 2016-06-02
# Для Amazon Payments
# http://sellercentral.amazon.com/gp/contact-us/contact-amazon-form.html?caseID=1766221511
# Иначе получим сбой: «'shmcb' session cache not supported»
LoadModule socache_shmcb_module modules/mod_socache_shmcb.so
# 2016-06-02 Для Amazon Payments: http://sellercentral.amazon.com/gp/contact-us/contact-amazon-form.html?caseID=1766221511
LoadModule ssl_module modules/mod_ssl.so
<IfModule unixd_module>
	Group daemon
	User daemon
</IfModule>
ServerAdmin dfediuk@gmail.com
<Directory />
	AllowOverride none
	Require all denied
</Directory>
<IfModule dir_module>
	DirectoryIndex index.html
</IfModule>
<Files ".ht*">
	Require all denied
</Files>
<IfModule log_config_module>
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "%h %l %u %t \"%r\" %>s %b" common
	<IfModule logio_module>
		LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
	</IfModule>
	CustomLog "logs/access.log" common
</IfModule>
<IfModule cgid_module>
</IfModule>
<Directory "${BP}/cgi-bin">
	AllowOverride None
	Options None
	Require all granted
</Directory>
<IfModule headers_module>
	RequestHeader unset Proxy early
</IfModule>
<IfModule mime_module>
	TypesConfig conf/mime.types
	AddType application/x-compress .Z
	AddType application/x-gzip .gz .tgz
</IfModule>
<IfModule proxy_html_module>
	Include conf/extra/proxy-html.conf
</IfModule>
<IfModule ssl_module>
	SSLRandomSeed startup builtin
	SSLRandomSeed connect builtin
</IfModule>