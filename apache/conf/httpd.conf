# 2024-07-28 "Refactor Apache settings": https://github.com/df-windows/server/issues/2
LoadModule access_compat_module modules/mod_access_compat.so
LoadModule actions_module modules/mod_actions.so
LoadModule alias_module modules/mod_alias.so
LoadModule allowmethods_module modules/mod_allowmethods.so
LoadModule asis_module modules/mod_asis.so
LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authn_file_module modules/mod_authn_file.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule autoindex_module modules/mod_autoindex.so
LoadModule cgi_module modules/mod_cgi.so
LoadModule dir_module modules/mod_dir.so
LoadModule env_module modules/mod_env.so
LoadModule headers_module modules/mod_headers.so
LoadModule include_module modules/mod_include.so
LoadModule isapi_module modules/mod_isapi.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule mime_module modules/mod_mime.so
LoadModule negotiation_module modules/mod_negotiation.so
LoadModule remoteip_module modules/mod_remoteip.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule setenvif_module modules/mod_setenvif.so
# 2016-06-02
# Для Amazon Payments
# http://sellercentral.amazon.com/gp/contact-us/contact-amazon-form.html?caseID=1766221511
# Иначе получим сбой: «'shmcb' session cache not supported»
LoadModule socache_shmcb_module modules/mod_socache_shmcb.so
# 2016-06-02 Для Amazon Payments: http://sellercentral.amazon.com/gp/contact-us/contact-amazon-form.html?caseID=1766221511
LoadModule ssl_module modules/mod_ssl.so
Define BP "C:/server/apache"
ErrorLog "C:/server/log/apache.log"
KeepAlive On
KeepAliveTimeout 600000
# 2021-04-18
# 1) The default value is `8190`: https://httpd.apache.org/docs/2.4/mod/core.html#limitrequestfieldsize
# 2) It is twice as high as in Magento (4096): https://github.com/magento/magento2/blob/2.4.2/lib/internal/Magento/Framework/Stdlib/Cookie/PhpCookieManager.php#L35
# https://stackoverflow.com/a/19285146
# 3) I have increased it up to `16000` to emulate the error:
# «Unable to send the cookie. Size of 'mage-messages' is 8226 bytes»
# https://github.com/canadasatellite-ca/site/issues/71
# 4) In my case, Nginx is uses as a proxy to Apache,
# and Nginx has a similar limit defined by the `large_client_header_buffers` parameter:
# http://nginx.org/en/docs/http/ngx_http_core_module.html#large_client_header_buffers
# I have increased it too in the `nginx.conf` file: `large_client_header_buffers 4 16k;`.
# https://stackoverflow.com/a/19285146
LimitRequestFieldSize 16000
Listen 80
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
LogFormat "%h %l %u %t \"%r\" %>s %b" common
# 2017-04-30
# Отключить mpm_winnt:notice и core:notice невозможно:
# «When logging to a regular file, messages of the level notice cannot be suppressed and thus are always logged.»
# https://httpd.apache.org/docs/2.4/mod/core.html#LogLevel
# 2024-08-01 https://httpd.apache.org/docs/2.4/mod/core.html#loglevel
LogLevel warn
MaxKeepAliveRequests 0
MaxRequestsPerChild 0
RequestHeader unset Proxy early
ServerAdmin dfediuk@gmail.com
ServerName localhost.com
ServerRoot "${BP}"
SSLRandomSeed startup builtin
SSLRandomSeed connect builtin
ThreadsPerChild 128
TimeOut 600000
TypesConfig conf/mime.types
AddType application/x-compress .Z
AddType application/x-gzip .gz .tgz
<Directory />
	AllowOverride none
	Require all denied
</Directory>
<Files ".ht*">
	Require all denied
</Files>
# 2016-06-02
# Для Amazon Payments
# http://sellercentral.amazon.com/gp/contact-us/contact-amazon-form.html?caseID=1766221511
# http://stackoverflow.com/questions/4221874/how-do-i-allow-https-for-apache-on-localhost
Include conf/extra/ssl.conf
# http://httpd.apache.org/docs/2.2/mod/core.html#include
# Говорят, что включение не является рекурсивным: http://stackoverflow.com/a/21808908/254475
# Однако размещение папки _disabled внутри папки sites резко тормозит перезагрузку Apache.
Include conf/sites/*.conf